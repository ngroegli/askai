# AskAI CLI - Configuration and Initialization Flow (Layered Architecture)
title: "Configuration & Initialization Flow"

startup: "Application Startup" {
  shape: oval
  style.fill: "#90CAF9" # Light Blue (core app/user)
}

# Utils Layer Configuration
utils_config: "Utils Layer" {
  shape: rectangle
  style.fill: "#F5F5F5" # Light Gray background
  style.stroke: "#757575"

  dir_check: "Directory Check\n(utils/config)" {
    shape: diamond
    style.fill: "#BDBDBD" # Light Gray
  }

  create_dirs: "Create Directories\n(utils/config)" {
    shape: rectangle
    style.fill: "#BDBDBD" # Light Gray
  }

  config_check: "Config File Check\n(utils/config)" {
    shape: diamond
    style.fill: "#BDBDBD" # Light Gray
  }

  load_config: "Load Configuration\n(utils/config.py)" {
    shape: rectangle
    style.fill: "#BDBDBD" # Light Gray
  }
}

# Presentation Layer Interaction
presentation_layer: "Presentation Layer" {
  shape: rectangle
  style.fill: "#F3E5F5" # Light Purple background

  setup_wizard: "Setup Wizard\n(utils/config + cli/)" {
    shape: rectangle
    style.fill: "#CE93D8" # Light Purple (CLI/user interaction)
  }
}

# Application Core
app_core: "Application Core" {
  shape: rectangle
  style.fill: "#E3F2FD" # Light Blue background

  init_components: "Initialize Components\n(main.py)" {
    shape: rectangle
    style.fill: "#90CAF9" # Light Blue (core app)
  }

  ready: "Application Ready" {
    shape: oval
    style.fill: "#90CAF9" # Light Blue (core app/user)
  }
}

# Component Initialization Details
components: "Layer Initialization" {
  shape: rectangle
  style.fill: "#E8F5E9" # Light Green background

  utils_init: "Utils Services\n(config, logging, helpers)" {
    style.fill: "#A5D6A7"
  }

  core_init: "Core Layer\n(ai, patterns, chat, questions, messaging)" {
    style.fill: "#A5D6A7"
  }

  output_init: "Output Layer\n(processors, writers, formatters)" {
    style.fill: "#A5D6A7"
  }
}

# Flow connections
startup -> utils_config.dir_check: "Check ~/.askai"
utils_config.dir_check -> utils_config.create_dirs: "Missing"
utils_config.dir_check -> utils_config.config_check: "Exists"
utils_config.create_dirs -> utils_config.config_check: "Created"
utils_config.config_check -> presentation_layer.setup_wizard: "Missing Config"
utils_config.config_check -> utils_config.load_config: "Config Exists"
presentation_layer.setup_wizard -> utils_config.load_config: "Config Created"
utils_config.load_config -> app_core.init_components: "Valid Config"
app_core.init_components -> components.utils_init: "Initialize Utils"
components.utils_init -> components.core_init: "Initialize Core"
components.core_init -> components.output_init: "Initialize Output"
components.output_init -> app_core.ready: "All Layers Ready"

# Configuration Details
utils_config.load_config: {
  label: "• API keys\n• Model settings\n• Path configurations\n• Logging setup"
}

app_core.init_components: {
  label: "• Layer-by-layer initialization\n• Dependency injection\n• Service registration"
}

# Error handling
utils_config.dir_check -> startup: "Permission Error" {
  style.stroke-dash: 5
  style.stroke: "#EF9A9A" # Light Red (error)
}
utils_config.config_check -> startup: "Invalid Config" {
  style.stroke-dash: 5
  style.stroke: "#EF9A9A" # Light Red
}
presentation_layer.setup_wizard -> startup: "Setup Cancelled" {
  style.stroke-dash: 5
  style.stroke: "#EF9A9A" # Light Red
}
