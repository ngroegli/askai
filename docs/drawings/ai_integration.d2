# AskAI CLI - AI Service Integration Architecture
title: "AI Service Integration Architecture"

# Application Core
app_core: "Application Core" {
  style.fill: "#E3F2FD" # Light Blue

  main_orchestrator: "Main Orchestrator (main.py)" {style.fill: "#90CAF9"}
}

# Core Layer - AI Services
ai_core: "Core Layer - AI" {
  style.fill: "#E8F5E9" # Light Green

  ai_service: "ai/service.py" {style.fill: "#A5D6A7"}
  openrouter_client: "ai/openrouter.py" {style.fill: "#A5D6A7"}
  model_config: "Model Configuration" {style.fill: "#A5D6A7"}
}

# Core Layer - Messaging
messaging_core: "Core Layer - Messaging" {
  style.fill: "#E8F5E9" # Light Green

  message_builder: "messaging/builder.py" {style.fill: "#A5D6A7"}
  content_encoder: "Content Encoder" {style.fill: "#A5D6A7"}
  format_handler: "Format Handler" {style.fill: "#A5D6A7"}
}

# Output Layer - Processing
output_layer: "Output Layer" {
  style.fill: "#FFF9C4" # Light Yellow

  output_coordinator: "coordinator.py" {style.fill: "#FFF176"}
  content_extractor: "processors/content.py" {style.fill: "#FFF176"}
  response_normalizer: "processors/normalizer.py" {style.fill: "#FFF176"}
  pattern_processor: "processors/pattern.py" {style.fill: "#FFF176"}
  directory_manager: "processors/directory.py" {style.fill: "#FFF176"}
}

# Utils Layer
utils: "Utils Layer" {
  style.fill: "#FAFAFA" # Light Gray

  config: "config.py" {style.fill: "#BDBDBD"}
  helpers: "helpers.py" {style.fill: "#BDBDBD"}
  logging: "logging.py" {style.fill: "#BDBDBD"}
}

# External Services
external: "External Services" {
  style.fill: "#FFF3E0" # Light Orange

  openrouter_api: "OpenRouter API" {style.fill: "#FFCC80"}
  ai_models: "AI Models (Claude, GPT, etc.)" {style.fill: "#FFCC80"}
  web_services: "Web Search Services" {style.fill: "#FFCC80"}
}

# Layer-to-Layer Connections
app_core -> ai_core: "AI service calls"
app_core -> messaging_core: "Message building"
app_core -> output_layer: "Response processing"
ai_core -> utils: "Configuration & utilities"
messaging_core -> utils: "Common services"
output_layer -> utils: "Logging & utilities"

# External Integration
ai_core -> external: "API requests"
external -> ai_core: "AI responses"

# Detailed Component Flows
app_core.main_orchestrator -> ai_core.ai_service: "Coordinate AI interactions"
ai_core.ai_service -> ai_core.model_config: "Configure models"
ai_core.model_config -> ai_core.openrouter_client: "Model settings"

messaging_core.message_builder -> messaging_core.content_encoder: "Encode content"
messaging_core.content_encoder -> messaging_core.format_handler: "Format messages"
messaging_core.format_handler -> ai_core.openrouter_client: "Formatted messages"

ai_core.openrouter_client -> external.openrouter_api: "HTTP requests"
external.openrouter_api -> external.ai_models: "Route to models"
external.ai_models -> external.openrouter_api: "Model responses"
external.openrouter_api -> ai_core.openrouter_client: "Raw responses"
ai_core.openrouter_client -> ai_core.ai_service: "AI response"
ai_core.ai_service -> app_core.main_orchestrator: "Processed response"
app_core.main_orchestrator -> output_layer.content_extractor: "Response for output"

output_layer.content_extractor -> output_layer.response_normalizer: "Extracted content"
output_layer.response_normalizer -> output_layer.output_coordinator: "Normalized responses"
output_layer.output_coordinator -> app_core.main_orchestrator: "Formatted results"

# Utils Services Integration
ai_core.ai_service -> utils.config: "API keys & settings"
messaging_core.message_builder -> utils.helpers: "File encoding & utilities"
ai_core.ai_service -> utils.logging: "Logging services"
output_layer.output_coordinator -> utils.logging: "Logging services"

# Multimodal and Web Search
messaging_core.content_encoder: {
  label: "• Image encoding (base64)\n• PDF text extraction\n• URL content fetching"
}

ai_core.openrouter_client: {
  label: "• Web search plugin integration\n• Multimodal content support\n• Error handling & retries"
}

output_layer.content_extractor: {
  label: "• JSON response parsing\n• Malformed JSON fallback\n• Pattern content extraction"
}
