# AskAI CLI - Pattern System Architecture
title: "Pattern System Architecture"

# Pattern Storage (External)
storage: "Pattern Storage" {
  shape: cylinder
  style.fill: "#E3F2FD" # Light Blue

  builtin: "Built-in Patterns" {style.fill: "#90CAF9"}
  private: "Private Patterns" {style.fill: "#90CAF9"}
}

# Core Layer - Patterns Package
patterns_core: "core/patterns/" {
  shape: rectangle
  style.fill: "#E8F5E9" # Light Green
  style.stroke: "#4CAF50"

  pattern_manager: "manager.py" {style.fill: "#A5D6A7"}
  pattern_inputs: "inputs.py" {style.fill: "#A5D6A7"}
  pattern_outputs: "outputs.py" {style.fill: "#A5D6A7"}
  pattern_config: "configuration.py" {style.fill: "#A5D6A7"}
}

# Core Layer - Messaging
messaging_core: "core/messaging/" {
  shape: rectangle
  style.fill: "#E8F5E9" # Light Green
  style.stroke: "#4CAF50"

  message_builder: "builder.py" {style.fill: "#A5D6A7"}
}

# Output Layer - Processing
output_layer: "output/" {
  shape: rectangle
  style.fill: "#FFF9C4" # Light Yellow
  style.stroke: "#FF9800"

  output_coordinator: "coordinator.py" {style.fill: "#FFF176"}

  processors: "processors/" {
    style.fill: "#FFF176"
    pattern_processor: "pattern.py" {style.fill: "#FFEB3B"}
    content_extractor: "content.py" {style.fill: "#FFEB3B"}
  }

  writers: "writers/" {
    style.fill: "#FFF176"
    file_writer_chain: "chain.py" {style.fill: "#FFEB3B"}
    html_writer: "html.py" {style.fill: "#FFEB3B"}
    css_writer: "css.py" {style.fill: "#FFEB3B"}
    js_writer: "javascript.py" {style.fill: "#FFEB3B"}
    json_writer: "json.py" {style.fill: "#FFEB3B"}
    markdown_writer: "markdown.py" {style.fill: "#FFEB3B"}
    text_writer: "text.py" {style.fill: "#FFEB3B"}
  }

  formatters: "formatters/" {
    style.fill: "#FFF176"
    terminal_formatter: "terminal.py" {style.fill: "#FFEB3B"}
    markdown_formatter: "markdown.py" {style.fill: "#FFEB3B"}
  }
}

# Utils Layer
utils: "utils/" {
  shape: rectangle
  style.fill: "#FAFAFA" # Light Gray
  style.stroke: "#757575"

  config: "config.py" {style.fill: "#BDBDBD"}
  logging: "logging.py" {style.fill: "#BDBDBD"}
  helpers: "helpers.py" {style.fill: "#BDBDBD"}
}

# External AI Services
ai_services: "External AI" {
  shape: rectangle
  style.fill: "#FFF3E0" # Light Orange

  openrouter: "OpenRouter API" {style.fill: "#FFCC80"}
}

# Pattern Processing Flow
patterns_core -> storage: "Load patterns"
patterns_core -> messaging_core: "Apply templates"
messaging_core -> ai_services: "Send to AI"
ai_services -> output_layer: "Process responses"
patterns_core -> utils: "Configuration & utilities"
output_layer -> utils: "Common services"

# Detailed component connections
pattern_manager -> pattern_inputs: "Input validation"
pattern_manager -> pattern_outputs: "Output definition"
pattern_manager -> pattern_config: "Configuration"
message_builder -> pattern_manager: "Template application"
output_coordinator -> processors.pattern_processor: "Pattern handling"
output_coordinator -> writers.file_writer_chain: "File operations"
output_coordinator -> formatters.terminal_formatter: "Display formatting"

# Utils services integration
pattern_manager -> utils.config: "Pattern directories & settings"
pattern_manager -> utils.logging: "Pattern processing logs"
message_builder -> utils.helpers: "File encoding & content processing"
message_builder -> utils.logging: "Message building logs"
output_coordinator -> utils.logging: "Output processing logs"
