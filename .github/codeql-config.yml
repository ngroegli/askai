# CodeQL Configuration for askai-cli
#
# This configuration file customizes CodeQL analysis for the askai-cli project.
# See: https://docs.github.com/en/code-security/code-scanning/automatically-scanning-your-code-for-vulnerabilities-and-errors/configuring-code-scanning

name: "CodeQL Config for askai-cli"

# Disable default queries and use custom configuration
disable-default-queries: false

# Query packs to use
packs:
  - codeql/python-queries

# Paths to exclude from analysis
paths-ignore:
  - 'tests/**'
  - 'docs/**'
  - '**/test_*.py'
  - '**/__pycache__/**'

# Custom query configuration
queries:
  - name: Use security-and-quality queries
    uses: security-and-quality

# Query filters - suppress specific false positives
# These path injection warnings are intentional CLI tool behavior
# where users explicitly specify files they want to access
query-filters:
  - exclude:
      id: py/path-injection
      problem:
        # Suppress for helpers.py - validated canonical paths for CLI file access
        location:
          file: 'src/askai/utils/helpers.py'
      reason: >
        CLI tool where users explicitly specify file paths. All paths are canonicalized
        with os.path.realpath() and validated for existence, type, and permissions.
        
  - exclude:
      id: py/path-injection
      problem:
        # Suppress for patterns.py API routes - sanitized extensions and validated temp paths  
        location:
          file: 'src/askai/presentation/api/routes/patterns.py'
      reason: >
        API file upload handler. Extensions are sanitized with character whitelist,
        temp files created with secure tempfile.mkstemp(), paths validated to be
        within temp directory.
